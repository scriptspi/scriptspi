<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOTS</title>
    <link rel="stylesheet" href="estilo.css">
</head>
<body>
    <div id="background">
    <div id="titulo">
    <h1 id="Pw">BOT X7 EDITAVEL</h1>
</div>
<div class="nav">
<a href="BOTS.html" class="textonav">Voltar</a>
<a href="https://discord.gg/aX25MCec27" target="_blank" class="textonav">Discord</a>
</div>
<div id="scriptmudo">
<p id="verde"> // discord https://discord.gg/aX25MCec27 <br>
</p>
<p id="preto">
    <br>
    // Stats: "Auth" : '["0-Games", "1-Wins", "2-Draws", "3-Losses", "4-Winrate", "5-Goals", "6-Assists", "7-GK", "8-CS", "9-CS%", "10-Role", "11-Nick"]'<br>
    <br>
/* VARIABLES */<br>
<br>
/* ROOM */<br>
<br>
const roomName = "BOT Futsal Editavel ate x7";<br>
const botName = "SPI - Ranger";<br>
const maxPlayers = 30;<br>
const roomPublic = true;<br>
const geo = [{"code": "ni", "lat": -23.6, "lon": -45.4}]; // Geo<br>
<br>
const room = HBInit({ roomName: roomName, maxPlayers: maxPlayers, public: roomPublic, playerName: botName, geo: geo[0] });<br>
<br>
const adminPassword = "fc_adminnx7_";<br>
<br>
const vipPassword = "fc_passwordvip";
<br>
const playersToSetVIP = 28;<br>
const playersToSetPublic = 27;<br>
<br>
const scoreLimitPractice = 0;<br>
const timeLimitPractice = 0;<br>
<br>
const scoreLimitx3 = 3;<br>
const timeLimitx3 = 3;<br>
<br>
const scoreLimitx4 = 3;<br>
const timeLimitx4 = 4;<br>
<br>
const scoreLimitx5 = 3;<br>
const timeLimitx5 = 5;<br>
<br>
const scoreLimitx7 = 3;<br>
const timeLimitx7 = 7;<br>
<br>
const frasesgoles = [" Mira que te como dijó ", " ¡Vestite que no se puede jugar desnudo en la cancha ", " Apareciendo cuando mas se le necesita, el amo y señor de haxball ", " estás on fire 🔥🔥🔥 ", " Increible el golazo de ", " Futbol champagne señores! de parte de ", " ¡BARRILETE COSMICO! ¿De que planeta viniste? ", " Impresionante definicion de ", " Que locura de gol acaba de hacer "];<br>
<br>
const frasesasis = [" 🔥🔥¡Y el pase milimetrico de ", " ¡Y donde pone el ojo pone el pase ", " ¡con tremendo pase de ", " ¡asistencia fenomenal de ", " ¡pase milimetrico de "];<br>
<br>
const frasesautogol = [" ¡Prende el monitor! ", " Para que te trajeee ", " ¡El troll de troles es ", " ¡Increible lo que hace este muchacho, pero sería mejor hacerlo en el arco contrario ", " ¡Genial ahora en el otro arco ", " ¡Se equivoco de arco ", " ¡Para el otro lado "];<br>
<br>
var isTimeAddedShown = false;<br>
var isTimeAddedShowndos = false;<br>
var isTimeAddedShowntres = false;<br>
var isTimeAddedShowncuatro = false;<br>
var isTimeAddedShowncinco = false;<br>
var isTimeAddedShownseis = false;<br>
var isTimeAddedShownquince = false;<br>
var isTimeAddedShownsiete = false;<br>
room.setTeamsLock(true);<br>
<br>
/* STADIUM */<br>
<br>
const playerRadius = 15;<br>
var ballRadius = 6.25;<br>
const triggerDistance = playerRadius + ballRadius + 0.01;<br>
<br>
var practiceMap = ''; // Insira seu mapa
<br>
var x3Map = ''; // Insira seu mapa
<br>
var x4Map = ''; // Insira seu mapa
<br>
var x5Map = ''; // Insira seu mapa
<br>
var x7Map = ''; // Insira seu mapa
<br>
/* OPTIONS */<br>
<br>
var afkLimit = 12;<br>
var drawTimeLimit = Infinity;<br>
var maxTeamSize = 3; // This works for 1 (you might want to adapt things to remove some useless stats in 1v1 like assist or cs), 2, 3 or 4<br>
var slowMode = 0;<br>
<br>
/* PLAYERS */<br>
<br>
const Team = { SPECTATORS: 0, RED: 1, BLUE: 2 };<br>
var extendedP = [];<br>
const eP = { ID: 0, AUTH: 1, CONN: 2, AFK: 3, ACT: 4, GK: 5, MUTE: 6 };<br>
const Ss = { GA: 0, WI: 1, DR: 2, LS: 3, WR: 4, GL: 5, AS: 6, GK: 7, CS: 8, CP: 9, RL: 10, NK: 11 }<br>
var players;<br>
var teamR;<br>
var teamB;<br>
var teamS;<br>
<br>
/* GAME */<br>
<br>
var lastTeamTouched;<br>
var lastPlayersTouched; // These allow to get good goal notifications (it should be lastPlayersKicked, waiting on a next update to get better track of shots on target)<br>
var countAFK = false; // Created to get better track of activity<br>
var activePlay = false; // Created to get better track of the possession<br>
var goldenGoal = false;<br>
var SMSet = new Set(); // Set created to get slow mode which is useful in chooseMode<br>
var banList = []; // Getting track of the bans, so we can unban ppl if we want<br>
<br>
/* STATS */<br>
<br>
var game;<br>
var GKList = ["", ""];<br>
var Rposs = 0;<br>
var Bposs = 0;<br>
var point = [{ "x": 0, "y": 0 }, { "x": 0, "y": 0 }]; // created to get ball speed<br>
var ballSpeed;<br>
var lastWinner = Team.SPECTATORS;<br>
var streak = 0;<br>
var allBlues = []; // This is to count the players who should be counted for the stats. This includes players who left after the game has started, doesn't include those who came too late or ...<br>
var allReds = []; // ... those who came in a very unequal game.<br>
<br>
/* BALANCE & CHOOSE */<br>
<br>
var inChooseMode = false; // This variable enables to distinguish the 2 phases of playing and choosing which should be dealt with very differently<br>
var redCaptainChoice = "";<br>
var blueCaptainChoice = "";<br>
var chooseTime = 20;<br>
var timeOutCap;<br>
<br>
/* AUXILIARY */<br>
<br>
var checkTimeVariable = false; // This is created so the chat doesn't get spammed when a game is ending via timeLimit<br>
var statNumber = 0; // This allows the room to be given stat information every X minutes<br>
var endGameVariable = false; // This variable with the one below helps distinguish the cases where games are stopped because they have finished to the ones where games are stopped due to player movements or resetting teams<br>
var resettingTeams = false;<br>
var capLeft = false;<br>
var statInterval = 6;<br>
<br>
loadMap(practiceMap, scoreLimitPractice, timeLimitPractice);<br>
<br>
/* OBJECTS */<br>
<br>
function Goal(time, team, striker, assist) {<br>
    this.time = time;<br>
    this.team = team;<br>
    this.striker = striker;<br>
    this.assist = assist;<br>
}<br>
<br>
function Game(date, scores, goals) {<br>
    this.date = date;<br>
    this.scores = scores;<br>
    this.goals = goals;<br>
}<br>
<br>
/* FUNCTIONS */<br>
<br>
/* AUXILIARY FUNCTIONS */<br>
<br>
function getRandomInt(max) { // returns a random number from 0 to max-1<br>
    return Math.floor(Math.random() * Math.floor(max));<br>
}<br>
<br>
function getTime(scores) { // returns the current time of the game<br>
    return "[" + Math.floor(Math.floor(scores.time / 60) / 10).toString() + Math.floor(Math.floor(scores.time / 60) % 10).toString() + ":" + Math.floor(Math.floor(scores.time - (Math.floor(scores.time / 60) * 60)) / 10).toString() + Math.floor(Math.floor(scores.time - (Math.floor(scores.time / 60) * 60)) % 10).toString() + "]"<br>
}<br>
<br>
function pointDistance(p1, p2) {<br>
    var d1 = p1.x - p2.x;<br>
    var d2 = p1.y - p2.y;<br>
    return Math.sqrt(d1 * d1 + d2 * d2);<br>
}<br>
<br>
/* BUTTONS */<br>
<br>
function PublicitaDiscord(player) {<br>
    var scores = room.getScores();<br>
    if (scores.time > 20 && !isTimeAddedShownseis) {<br>
    room.sendAnnouncement("                                        ▒█▀▀▄ ▀█▀ ▒█▀▀▀█ ▒█▀▀█ ▒█▀▀▀█ ▒█▀▀█ ▒█▀▀▄ ", null, 0x9250FD, "bold")<br>
    room.sendAnnouncement("                                        ▒█░▒█ ▒█░ ░▀▀▀▄▄ ▒█░░░ ▒█░░▒█ ▒█▄▄▀ ▒█░▒█ ", null, 0x8466FD, "bold")<br>
    room.sendAnnouncement("                                        ▒█▄▄▀ ▄█▄ ▒█▄▄▄█ ▒█▄▄█ ▒█▄▄▄█ ▒█░▒█ ▒█▄▄▀ ", null, 0x7B73FD, "bold");<br>
    room.sendAnnouncement("                                        💬  https://discord.gg/ ⬅⬅⬅ 𝗙𝘂𝘁𝘀𝗮𝗹 𝗖𝗼𝗺𝗺𝘂𝗻𝗶𝘁𝘆 [𝗡𝘂𝗲𝘃𝗼]", null, 0xF6FF43, "bold");<br>
    room.sendAnnouncement("                                        💬  https://discord.gg/ ⬅⬅⬅ 𝗙𝘂𝘁𝘀𝗮𝗹 𝗟𝗲𝗮𝗴𝘂𝗲 [𝗟𝗶𝗴𝗮]", null, 0xF6FF43, "bold");<br>
    isTimeAddedShownseis = true;<br>
    }<br>
}<br>
<br>
function PublicitaDonacion(player) {<br>
    var scores = room.getScores();<br>
    if (scores.time > 40 && !isTimeAddedShownsiete) {<br>
    room.sendAnnouncement("                     <br>                                                                                      ░█▀▀▄ ░█▀▀▀█ ░█▄─░█ ─█▀▀█", player, 0xffcd2c, "normal", 0);
    room.sendAnnouncement("                      <br>                                                                                     ░█─░█ ░█──░█ ░█░█░█ ░█▄▄█", player, 0xea8f73, "normal", 0);
    room.sendAnnouncement("                              <br>                                                                             ░█▄▄▀ ░█▄▄▄█ ░█──▀█ ░█─░█", player, 0xd757b3, "normal", 0);
    room.sendAnnouncement("                       ¡𝗗𝗼𝗻𝗮 𝘆 𝗼𝗯𝘁𝗲𝗻𝗲 𝘃𝗶𝗽 𝘆 𝗺𝗮𝘀 𝗯𝗲𝗻𝗲𝗳𝗶𝗰𝗶𝗼𝘀!", player, 0xd733ff, "bold", 0);<br>
    room.sendAnnouncement("                                  <br>                                                                        ➡➡  🔗 ʟɪɴᴋ: https://discord.gg/", player, 0xf1ff33, "bold");
    isTimeAddedShownsiete = true;
    }<br>
}<br>
<br>
function PublicitaHelp(player) {<br>
    var scores = room.getScores();<br>
    if (scores.time > 10 && !isTimeAddedShowncinco) {<br>
    room.sendAnnouncement("「📣」 ¡𝗨𝘀𝗮 '!𝗮𝘆𝘂𝗱𝗮' 𝗽𝗮𝗿𝗮 𝘃𝗲𝗿 𝗹𝗮 𝗹𝗶𝘀𝘁𝗮 𝗱𝗲 𝗰𝗼𝗺𝗮𝗻𝗱𝗼𝘀 𝗱𝗶𝘀𝗽𝗼𝗻𝗶𝗯𝗹𝗲𝘀!", player, 0xd733ff, "bold", 0);<br>
    isTimeAddedShowncinco = true;<br>
    }<br>
}<br>
<br>
function PublicitaLiga(player) {<br>
    var scores = room.getScores();<br>
    if (scores.time > 80 && !isTimeAddedShowncuatro) {<br>
    room.sendAnnouncement("「📣」 𝗧𝗲𝗻𝗲𝗺𝗼𝘀 𝘂𝗻𝗮 𝗹𝗶𝗴𝗮 𝗱𝗲 𝘅𝟰 𝗱𝗲𝗱𝗶𝗰𝗮𝗱𝗮 𝗮 𝗹𝗮 𝗰𝗼𝗺𝘂𝗻𝗶𝗱𝗮𝗱. 𝗠𝗮𝘀 𝗶𝗻𝗳𝗼𝗿𝗺𝗮𝗰𝗶𝗼𝗻 𝘂𝘀𝗮𝗻𝗱𝗼 '!𝗱𝗶𝘀𝗰𝗼𝗿𝗱'", player, 0xd733ff, "bold", 0);<br>
    isTimeAddedShowncuatro = true;<br>
    }<br>
}<br>
<br>
function topBtn() {<br>
    if (teamS.length == 0) {<br>
        return;<br>
    }<br>
    else {<br>
        if (teamR.length == teamB.length) {<br>
            if (teamS.length > 1) {<br>
                room.setPlayerTeam(teamS[0].id, Team.RED);<br>
                room.setPlayerTeam(teamS[1].id, Team.BLUE);<br>
            }<br>
            return;<br>
        }<br>
        else if (teamR.length < teamB.length) {<br>
            room.setPlayerTeam(teamS[0].id, Team.RED);<br>
        }<br>
        else {<br>
            room.setPlayerTeam(teamS[0].id, Team.BLUE);<br>
        }<br>
    }<br>
}<br>
<br>
function randomBtn() {<br>
    if (teamS.length == 0) {<br>
        return;<br>
    }<br>
    else {<br>
        if (teamR.length == teamB.length) {<br>
            if (teamS.length > 1) {<br>
                var r = getRandomInt(teamS.length);<br>
                room.setPlayerTeam(teamS[r].id, Team.RED);<br>
                teamS = teamS.filter((spec) => spec.id != teamS[r].id);<br>
                room.setPlayerTeam(teamS[getRandomInt(teamS.length)].id, Team.BLUE);<br>
            }<br>
            return;<br>
        }<br>
        else if (teamR.length < teamB.length) {<br>
            room.setPlayerTeam(teamS[getRandomInt(teamS.length)].id, Team.RED);<br>
        }<br>
        else {<br>
            room.setPlayerTeam(teamS[getRandomInt(teamS.length)].id, Team.BLUE);<br>
        }<br>
    }<br>
}<br>
<br>
function blueToSpecBtn() {<br>
    resettingTeams = true;<br>
    setTimeout(() => { resettingTeams = false; }, 100);<br>
    for (var i = 0; i < teamB.length; i++) {<br>
        room.setPlayerTeam(teamB[teamB.length - 1 - i].id, Team.SPECTATORS);<br>
    }<br>
}<br>
<br>
function redToSpecBtn() {<br>
    resettingTeams = true;<br>
    setTimeout(() => { resettingTeams = false; }, 100);<br>
    for (var i = 0; i < teamR.length; i++) {<br>
        room.setPlayerTeam(teamR[teamR.length - 1 - i].id, Team.SPECTATORS);<br>
    }<br>
}<br>
<br>
function resetBtn() {<br>
    resettingTeams = true;<br>
    setTimeout(() => { resettingTeams = false; }, 100);<br>
    if (teamR.length <= teamB.length) {<br>
        for (var i = 0; i < teamR.length; i++) {<br>
            room.setPlayerTeam(teamB[teamB.length - 1 - i].id, Team.SPECTATORS);<br>
            room.setPlayerTeam(teamR[teamR.length - 1 - i].id, Team.SPECTATORS);<br>
        }<br>
        for (var i = teamR.length; i < teamB.length; i++) {<br>
            room.setPlayerTeam(teamB[teamB.length - 1 - i].id, Team.SPECTATORS);<br>
        }<br>
    }<br>
    else {<br>
        for (var i = 0; i < teamB.length; i++) {<br>
            room.setPlayerTeam(teamB[teamB.length - 1 - i].id, Team.SPECTATORS);<br>
            room.setPlayerTeam(teamR[teamR.length - 1 - i].id, Team.SPECTATORS);<br>
        }<br>
        for (var i = teamB.length; i < teamR.length; i++) {<br>
            room.setPlayerTeam(teamR[teamR.length - 1 - i].id, Team.SPECTATORS);<br>
        }<br>
    }<br>
}<br>
<br>
function blueToRedBtn() {<br>
    resettingTeams = true;<br>
    setTimeout(() => { resettingTeams = false; }, 100);<br>
    for (var i = 0; i < teamB.length; i++) {<br>
        room.setPlayerTeam(teamB[i].id, Team.RED);<br>
    }<br>
}<br>
<br>
/* GAME FUNCTIONS */<br>
<br>
function checkTime() {<br>
    const scores = room.getScores();<br>
    game.scores = scores;<br>
    if (Math.abs(scores.time - scores.timeLimit) <= 0.01 && scores.timeLimit != 0) {<br>
        if (scores.red != scores.blue) {<br>
            if (checkTimeVariable == false) {<br>
                checkTimeVariable = true;<br>
                setTimeout(() => { checkTimeVariable = false; }, 3000);<br>
                scores.red > scores.blue ? endGame(Team.RED) : endGame(Team.BLUE);<br>
                setTimeout(() => { room.stopGame(); }, 2000);<br>
            }<br>
            return;<br>
        }<br>
        goldenGoal = true;<br>
        room.sendChat("⚽ Gol gana !");<br>
    }<br>
    if (Math.abs(drawTimeLimit * 60 - scores.time - 60) <= 0.01 && players.length > 2) {<br>
        if (checkTimeVariable == false) {<br>
            checkTimeVariable = true;<br>
            setTimeout(() => { checkTimeVariable = false; }, 10);<br>
            room.sendChat("⌛ Quedan 60 segundos para que termine el partido !");<br>
        }<br>
    }<br>
    if (Math.abs(scores.time - drawTimeLimit * 60) <= 0.01 && players.length > 2) {<br>
        if (checkTimeVariable == false) {<br>
            checkTimeVariable = true;<br>
            setTimeout(() => { checkTimeVariable = false; }, 10);<br>
            endGame(Team.SPECTATORS);<br>
            room.stopGame();<br>
            goldenGoal = false;<br>
        }<br>
    }<br>
}<br>
<br>
function endGame(winner) { // handles the end of a game : no stopGame function inside<br>
    players.length >= 2 * maxTeamSize - 1 ? activateChooseMode() : null;<br>
    const scores = room.getScores();<br>
    game.scores = scores;<br>
    Rposs = Rposs / (Rposs + Bposs);<br>
    Bposs = 1 - Rposs;<br>
    lastWinner = winner;<br>
    endGameVariable = true;<br>
    if (winner == Team.RED) {<br>
        streak++;<br>
        room.sendChat("🔴 El Red Team ganó " + scores.red + "-" + scores.blue + " ! Victorias consecutivas : " + streak + " 🏆");<br>
    }<br>
    else if (winner == Team.BLUE) {<br>
        streak = 1;<br>
        room.sendChat("🔵 El Blue Team ganó " + scores.blue + "-" + scores.red + " ! Victorias consecutivas : " + streak + " 🏆");<br>
    }<br>
    else {<br>
        streak = 0;<br>
        room.sendChat("💤 Límite de empate, terminado! 💤");<br>
    }
    room.sendChat("⭐ Posesión del balón : 🔴 " + (Rposs * 100).toPrecision(3).toString() + "% : " + (Bposs * 100).toPrecision(3).toString() + "% 🔵");<br>
    scores.red == 0 ? (scores.blue == 0 ? room.sendChat("🏆 " + GKList[0].name + " y " + GKList[1].name + " mantuvieron la valla invicta ! ") : room.sendChat("🏆 " + GKList[1].name + " mantuvo la valla invicta ! ")) : scores.blue == 0 ? room.sendChat("🏆 " + GKList[0].name + " mantuvo la valla invicta ! ") : null;<br>
    updateStats();<br>
}<br>
<br>
function quickRestart() {<br>
    room.stopGame();<br>
    setTimeout(() => { room.startGame(); }, 2000);<br>
}<br>
<br>
function resumeGame() {<br>
    setTimeout(() => { room.startGame(); }, 2000);<br>
    setTimeout(() => { room.pauseGame(false); }, 1000);<br>
}<br>
<br>
function activateChooseMode() {<br>
    inChooseMode = true;<br>
    slowMode = 2;<br>
    room.sendChat("Modo lento activado (2 segundos)!");<br>
}<br>
<br>
function deactivateChooseMode() {<br>
    inChooseMode = false;<br>
    clearTimeout(timeOutCap);<br>
    if (slowMode != 0) {<br>
        slowMode = 0;<br>
        room.sendChat("Modo lento terminado.");<br>
    }<br>
    redCaptainChoice = "";<br>
    blueCaptainChoice = "";<br>
}<br>
<br>
function loadMap(map, scoreLim, timeLim) {<br>
    if (map != '') {<br>
        room.setCustomStadium(map);<br>
    } else {<br>
        console.log("error cargando mapa")<br>
        room.setDefaultStadium("Classic");<br>
    }<br>
    room.setScoreLimit(scoreLim);<br>
    room.setTimeLimit(timeLim);<br>
}<br>
<br>
/* PLAYER FUNCTIONS */<br>
<br>
function updateTeams() { // update the players' list and all the teams' list<br>
    players = room.getPlayerList().filter((player) => player.id != 0 && !getAFK(player));<br>
    teamR = players.filter(p => p.team === Team.RED);<br>
    teamB = players.filter(p => p.team === Team.BLUE);<br>
    teamS = players.filter(p => p.team === Team.SPECTATORS);<br>
}<br>

function handleInactivity() { // handles inactivity : players will be kicked after afkLimit<br>
    if (countAFK && (teamR.length + teamB.length) > 1) {<br>
        for (var i = 0; i < teamR.length; i++) {<br>
            setActivity(teamR[i], getActivity(teamR[i]) + 1);<br>
        }<br>
        for (var i = 0; i < teamB.length; i++) {<br>
            setActivity(teamB[i], getActivity(teamB[i]) + 1);<br>
        }<br>
    }<br>
    for (var i = 0; i < extendedP.length; i++) {<br>
        if (extendedP[i][eP.ACT] == 60 * (2 / 3 * afkLimit)) {<br>
            room.sendChat("[PV] ⛔ @" + room.getPlayer(extendedP[i][eP.ID]).name + ", si no te mueves o envías un mensaje dentro de los siguientes " + Math.floor(afkLimit / 3) + " segundos, seras kickeado!", extendedP[i][eP.ID]);<br>
        }<br>
        if (extendedP[i][eP.ACT] >= 60 * afkLimit) {<br>
            extendedP[i][eP.ACT] = 0;<br>
            if (room.getScores().time <= afkLimit - 0.5) {<br>
                setTimeout(() => { !inChooseMode ? quickRestart() : room.stopGame(); }, 10);<br>
            }<br>
            room.kickPlayer(extendedP[i][eP.ID], "AFK", false);<br>
        }<br>
    }<br>
}<br>
<br>
function getAuth(player) {<br>
    return extendedP.filter((a) => a[0] == player.id) != null ? extendedP.filter((a) => a[0] == player.id)[0][eP.AUTH] : null;<br>
}<br>
<br>
function getAFK(player) {<br>
    return extendedP.filter((a) => a[0] == player.id) != null ? extendedP.filter((a) => a[0] == player.id)[0][eP.AFK] : null;<br>
}<br>
<br>
function setAFK(player, value) {<br>
    extendedP.filter((a) => a[0] == player.id).forEach((player) => player[eP.AFK] = value);<br>
}<br>
<br>
function getActivity(player) {<br>
    return extendedP.filter((a) => a[0] == player.id) != null ? extendedP.filter((a) => a[0] == player.id)[0][eP.ACT] : null;<br>
}<br>
<br>
function setActivity(player, value) {<br>
    extendedP.filter((a) => a[0] == player.id).forEach((player) => player[eP.ACT] = value);<br>
}<br>
<br>
function getGK(player) {<br>
    return extendedP.filter((a) => a[0] == player.id) != null ? extendedP.filter((a) => a[0] == player.id)[0][eP.GK] : null;<br>
}<br>

function setGK(player, value) {<br>
    extendedP.filter((a) => a[0] == player.id).forEach((player) => player[eP.GK] = value);<br>
}<br>
<br>
function getMute(player) {<br>
    return extendedP.filter((a) => a[0] == player.id) != null ? extendedP.filter((a) => a[0] == player.id)[0][eP.MUTE] : null;<br>
}<br>
<br>
function setMute(player, value) {<br>
    extendedP.filter((a) => a[0] == player.id).forEach((player) => player[eP.MUTE] = value);<br>
}<br>
<br>
/* BALANCE & CHOOSE FUNCTIONS */<br>
<br>
function updateRoleOnPlayerIn() {<br>
    updateTeams();<br>
    if (inChooseMode) {<br>
        if (players.length == 6) {<br>
            loadMap(x3Map, scoreLimitx3, timeLimitx3); <br>
        }<br>
        getSpecList(teamR.length <= teamB.length ? teamR[0] : teamB[0]);<br>
    }<br>
    balanceTeams();<br>
}<br>
<br>
function updateRoleOnPlayerOut() {<br>
    updateTeams();<br>
    if (room.getScores() != null) {<br>
        var scores = room.getScores();<br>
        if (players.length >= 2 * maxTeamSize && scores.time >= (5 / 6) * game.scores.timeLimit && teamR.length != teamB.length) {<br>
            if (teamR.length < teamB.length) {<br>
                if (scores.blue - scores.red == 2) {<br>
                    endGame(Team.BLUE);<br>
                    room.sendChat("🤖 Abandono detectado. Juego terminado 🤖");<br>
                    setTimeout(() => { room.stopGame(); }, 100);<br>
                    return;<br>
                }<br>
            }<br>
            else {<br>
                if (scores.red - scores.blue == 2) {<br>
                    endGame(Team.RED);<br>
                    room.sendChat("🤖 Abandono detectado. Juego terminado 🤖");<br>
                    setTimeout(() => { room.stopGame(); }, 100);<br>
                    return;<br>
                }<br>
            }<br>
        }<br>
    }<br>
    if (inChooseMode) {<br>
        if (players.length < 6) {<br>
            loadMap(practiceMap, scoreLimitPractice, timeLimitPractice);<br>
        }<br>
        if (teamR.length == 0 || teamB.length == 0) {<br>
            teamR.length == 0 ? room.setPlayerTeam(teamS[0].id, Team.RED) : room.setPlayerTeam(teamS[0].id, Team.BLUE);<br>
            return;<br>
        }<br>
        if (Math.abs(teamR.length - teamB.length) == teamS.length) {<br>
            room.sendChat("No hay alternativa, déjame manejar esta situación ...");<br>
            deactivateChooseMode();<br>
            resumeGame();<br>
            var b = teamS.length;<br>
            if (teamR.length > teamB.length) {<br>
                for (var i = 0; i < b; i++) {<br>
                    setTimeout(() => { room.setPlayerTeam(teamS[0].id, Team.BLUE); }, 5 * i);<br>
                }<br>
            }<br>
            else {<br>
                for (var i = 0; i < b; i++) {<br>
                    setTimeout(() => { room.setPlayerTeam(teamS[0].id, Team.RED); }, 5 * i);<br>
                }<br>
            }<br>
            return;<br>
        }<br>
        if (streak == 0 && room.getScores() == null) {<br>
            if (Math.abs(teamR.length - teamB.length) == 2) { // if someone left a team has 2 more players than the other one, put the last chosen guy back in his place so it's fair<br>
                room.sendChat("🤖 Equilibrando equipos... 🤖");<br>
                teamR.length > teamB.length ? room.setPlayerTeam(teamR[teamR.length - 1].id, Team.SPECTATORS) : room.setPlayerTeam(teamB[teamB.length - 1].id, Team.SPECTATORS);
            }<br>
        }<br>
        if (teamR.length == teamB.length && teamS.length < 2) {<br>
            deactivateChooseMode();<br>
            resumeGame();<br>
            return;<br>
        }<br>
        capLeft ? choosePlayer() : getSpecList(teamR.length <= teamB.length ? teamR[0] : teamB[0]);<br>
    }<br>
    balanceTeams();<br>
}<br>
<br>
function balanceTeams() {<br>
    if (!inChooseMode) {<br>
        if (players.length == 1 && teamR.length == 0) { // 1 player<br>
            quickRestart();<br>
            loadMap(practiceMap, scoreLimitPractice, timeLimitPractice);<br>
            room.setPlayerTeam(players[0].id, Team.RED);<br>
        }<br>
        else if (Math.abs(teamR.length - teamB.length) == teamS.length && teamS.length > 0) { // spec players supply required <br>players
            const n = Math.abs(teamR.length - teamB.length);<br>
            if (teamR.length > teamB.length) {<br>
                for (var i = 0; i < n; i++) {<br>
                    room.setPlayerTeam(teamS[i].id, Team.BLUE);<br>
                }<br>
            }<br>
            else {<br>
                for (var i = 0; i < n; i++) {<br>
                    room.setPlayerTeam(teamS[i].id, Team.RED);<br>
                }<br>
            }<br>
        }<br>
        else if (Math.abs(teamR.length - teamB.length) > teamS.length) { //no sufficient players<br>
            const n = Math.abs(teamR.length - teamB.length);<br>
            if (players.length == 1) {<br>
                quickRestart();<br>
                loadMap(practiceMap, scoreLimitPractice, timeLimitPractice);<br>
                room.setPlayerTeam(players[0].id, Team.RED);<br>
                return;<br>
            }<br>
            else if (players.length == 6) {<br>
                quickRestart();<br>
                loadMap(x3Map, scoreLimitx3, timeLimitx3);<br>
            }<br>
            if (players.length == maxTeamSize * 2 - 1) {<br>
                allReds = [];<br>
                allBlues = [];<br>
            }<br>
            if (teamR.length > teamB.length) {<br>
                for (var i = 0; i < n; i++) {<br>
                    room.setPlayerTeam(teamR[teamR.length - 1 - i].id, Team.SPECTATORS);<br>
                }<br>
            }<br>
            else {<br>
                for (var i = 0; i < n; i++) {<br>
                    room.setPlayerTeam(teamB[teamB.length - 1 - i].id, Team.SPECTATORS);<br>
                }<br>
            }<br>
        }<br>
        else if (Math.abs(teamR.length - teamB.length) < teamS.length && teamR.length != teamB.length) { //choose mode<br>
            room.pauseGame(true);<br>
            activateChooseMode();<br>
            choosePlayer();<br>
        }<br>
        else if (teamS.length >= 2 && teamR.length == teamB.length && teamR.length < maxTeamSize) { //2 in red 2 in blue and 2 or <br>more spec
            if (teamR.length == 2) {<br>
                quickRestart();<br>
                if (!teamS.length == 2){<br>
                    loadMap(x3Map, scoreLimitx3, timeLimitx3);<br>
                }<br>
            }<br>
            topBtn();<br>
        }<br>
    }<br>
}<br>
<br>
function choosePlayer() {<br>
    clearTimeout(timeOutCap);<br>
    if (teamR.length <= teamB.length && teamR.length != 0) {<br>
        room.sendChat("[PV] Para elegir un jugador, ingrese su número en la lista dada o use 'top', 'random' o 'bottom'.", teamR[0].id);<br>
        timeOutCap = setTimeout(function (player) { room.sendChat("[PV] Date prisa @" + player.name + ", solo quedan " + Number.<br>parseInt(chooseTime / 2) + " segundos para elegir !", player.id); timeOutCap = setTimeout(function (player) { room.<br>kickPlayer(player.id, "¡No elegiste a tiempo!", false); }, chooseTime * 500, teamR[0]); }, chooseTime * 1000, teamR[0]);<br>
    }<br>
    else if (teamB.length < teamR.length && teamB.length != 0) {<br>
        room.sendChat("[PV] Para elegir un jugador, ingrese su número en la lista dada o use 'top', 'random' o 'bottom'.", teamB[0].<br>id);
        timeOutCap = setTimeout(function (player) { room.sendChat("[PV] Date prisa @" + player.name + ", solo quedan " + Number.<br>parseInt(chooseTime / 2) + " segundos para elegir !", player.id); timeOutCap = setTimeout(function (player) { room.<br>kickPlayer(player.id, "¡No elegiste a tiempo!", false); }, chooseTime * 500, teamB[0]); }, chooseTime * 1000, teamB[0]);<br>
    }<br>
    if (teamR.length != 0 && teamB.length != 0) getSpecList(teamR.length <= teamB.length ? teamR[0] : teamB[0]);<br>
}<br>
<br>
function getSpecList(player) {<br>
    var cstm = "[PV] Jugadores : ";<br>
    for (var i = 0; i < teamS.length; i++) {<br>
        if (140 - cstm.length < (teamS[i].name + "[" + (i + 1) + "], ").length) {<br>
            room.sendChat(cstm, player.id);<br>
            cstm = "... ";<br>
        }<br>
        cstm += teamS[i].name + "[" + (i + 1) + "], ";<br>
    }<br>
    cstm = cstm.substring(0, cstm.length - 2);<br>
    cstm += ".";<br>
    room.sendChat(cstm, player.id);<br>
}<br>
<br>
/* STATS FUNCTIONS */<br>
<br>
function getLastTouchOfTheBall() {<br>
    const ballPosition = room.getBallPosition();<br>
    updateTeams();<br>
    for (var i = 0; i < players.length; i++) {<br>
        if (players[i].position != null) {<br>
            var distanceToBall = pointDistance(players[i].position, ballPosition);<br>
            if (distanceToBall < triggerDistance) {<br>
                !activePlay ? activePlay = true : null;<br>
                if (lastTeamTouched == players[i].team && lastPlayersTouched[0] != null && lastPlayersTouched[0].id != players[i].<br>id) {
                    lastPlayersTouched[1] = lastPlayersTouched[0];<br>
                    lastPlayersTouched[0] = players[i];<br>
                }<br>
                lastTeamTouched = players[i].team;<br>
            }<br>
        }<br>
    }<br>
}<br>
<br>
function getStats() { // gives possession, ball speed and GK of each team<br>
    if (activePlay) {<br>
        updateTeams();<br>
        lastTeamTouched == Team.RED ? Rposs++ : Bposs++;<br>
        var ballPosition = room.getBallPosition();<br>
        point[1] = point[0];<br>
        point[0] = ballPosition;<br>
        ballSpeed = (pointDistance(point[0], point[1]) * 60 * 60 * 60) / 15000;<br>
        var k = [-1, Infinity];<br>
        for (var i = 0; i < teamR.length; i++) {<br>
            if (teamR[i].position.x < k[1]) {<br>
                k[0] = teamR[i];<br>
                k[1] = teamR[i].position.x;<br>
            }<br>
        }<br>
        k[0] != -1 ? setGK(k[0], getGK(k[0]) + 1) : null;<br>
        k = [-1, -Infinity];<br>
        for (var i = 0; i < teamB.length; i++) {<br>
            if (teamB[i].position.x > k[1]) {<br>
                k[0] = teamB[i];<br>
                k[1] = teamB[i].position.x;<br>
            }<br>
        }<br>
        k[0] != -1 ? setGK(k[0], getGK(k[0]) + 1) : null;<br>
        findGK();<br>
    }<br>
}<br>
<br>
function updateStats() {<br>
    if (players.length >= 2 * maxTeamSize && (game.scores.time >= (5 / 6) * game.scores.timeLimit || game.scores.red == game.scores.<br>scoreLimit || game.scores.blue == game.scores.scoreLimit) && allReds.length >= maxTeamSize && allBlues.length >= maxTeamSize) {<br>
        var stats;<br>
        for (var i = 0; i < allReds.length; i++) {<br>
            localStorage.getItem(getAuth(allReds[i])) ? stats = JSON.parse(localStorage.getItem(getAuth(allReds[i]))) : stats = [0, <br>0, 0, 0, "0.00", 0, 0, 0, 0, "0.00", "player", allReds[i].name];
            stats[Ss.GA]++;<br>
            lastWinner == Team.RED ? stats[Ss.WI]++ : lastWinner == Team.BLUE ? stats[Ss.LS]++ : stats[Ss.DR]++;<br>
            stats[Ss.WR] = (100 * stats[Ss.WI] / stats[Ss.GA]).toPrecision(3);<br>
            localStorage.setItem(getAuth(allReds[i]), JSON.stringify(stats));<br>
        }<br>
        for (var i = 0; i < allBlues.length; i++) {<br>
            localStorage.getItem(getAuth(allBlues[i])) ? stats = JSON.parse(localStorage.getItem(getAuth(allBlues[i]))) : stats = <br>[0, 0, 0, 0, "0.00", 0, 0, 0, 0, "0.00", "player", allBlues[i].name];
            stats[Ss.GA]++;<br>
            lastWinner == Team.BLUE ? stats[Ss.WI]++ : lastWinner == Team.RED ? stats[Ss.LS]++ : stats[Ss.DR]++;<br>
            stats[Ss.WR] = (100 * stats[Ss.WI] / stats[Ss.GA]).toPrecision(3);<br>
            localStorage.setItem(getAuth(allBlues[i]), JSON.stringify(stats));<br>
        }<br>
        for (var i = 0; i < game.goals.length; i++) {<br>
            if (game.goals[i].striker != null) {<br>
                if ((allBlues.concat(allReds)).findIndex((player) => player.id == game.goals[i].striker.id) != -1) {<br>
                    stats = JSON.parse(localStorage.getItem(getAuth(game.goals[i].striker)));<br>
                    stats[Ss.GL]++;<br>
                    localStorage.setItem(getAuth(game.goals[i].striker), JSON.stringify(stats));<br>
                }<br>
            }<br>
            if (game.goals[i].assist != null) {<br>
                if ((allBlues.concat(allReds)).findIndex((player) => player.name == game.goals[i].assist.name) != -1) {<br>
                    stats = JSON.parse(localStorage.getItem(getAuth(game.goals[i].assist)));<br>
                    stats[Ss.AS]++;<br>
                    localStorage.setItem(getAuth(game.goals[i].assist), JSON.stringify(stats));<br>
                }<br>
            }<br>
        }<br>
        if (allReds.findIndex((player) => player.id == GKList[0].id) != -1) {<br>
            stats = JSON.parse(localStorage.getItem(getAuth(GKList[0])));<br>
            stats[Ss.GK]++;<br>
            game.scores.blue == 0 ? stats[Ss.CS]++ : null;<br>
            stats[Ss.CP] = (100 * stats[Ss.CS] / stats[Ss.GK]).toPrecision(3);<br>
            localStorage.setItem(getAuth(GKList[0]), JSON.stringify(stats));<br>
        }<br>
        if (allBlues.findIndex((player) => player.id == GKList[1].id) != -1) {<br>
            stats = JSON.parse(localStorage.getItem(getAuth(GKList[1])));<br>
            stats[Ss.GK]++;<br>
            game.scores.red == 0 ? stats[Ss.CS]++ : null;<br>
            stats[Ss.CP] = (100 * stats[Ss.CS] / stats[Ss.GK]).toPrecision(3);<br>
            localStorage.setItem(getAuth(GKList[1]), JSON.stringify(stats));<br>
        }<br>
    }<br>
}<br>
<br>
function findGK() {<br>
    var tab = [[-1, ""], [-1, ""]];<br>
    for (var i = 0; i < extendedP.length; i++) {
        if (room.getPlayer(extendedP[i][eP.ID]) != null && room.getPlayer(extendedP[i][eP.ID]).team == Team.RED) {<br>
            if (tab[0][0] < extendedP[i][eP.GK]) {<br>
                tab[0][0] = extendedP[i][eP.GK];<br>
                tab[0][1] = room.getPlayer(extendedP[i][eP.ID]);<br>
            }<br>
        }<br>
        else if (room.getPlayer(extendedP[i][eP.ID]) != null && room.getPlayer(extendedP[i][eP.ID]).team == Team.BLUE) {<br>
            if (tab[1][0] < extendedP[i][eP.GK]) {<br>
                tab[1][0] = extendedP[i][eP.GK];<br>
                tab[1][1] = room.getPlayer(extendedP[i][eP.ID]);<br>
            }<br>
        }<br>
    }<br>
    GKList = [tab[0][1], tab[1][1]];<br>
}<br>
<br>
setInterval(() => {<br>
    var tableau = [];<br>
    if (statNumber % 5 == 0) {<br>
        Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))<br>[Ss.GA])]); } });
        if (tableau.length < 5) {<br>
            return false;<br>
        }<br>
        <br>tableau.sort(function (a, b) { return b[1] - a[1]; });
        <br>room.sendChat("Partidos Jugados> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1][1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4]<br>[0] + ": " + tableau[4][1]);
    }<br>
    if (statNumber % 5 == 1) {<br>
        Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))<br>[Ss.WI])]); } });
        if (tableau.length < 5) {<br>
            return false;<br>
        }<br>
        tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
        room.sendChat("Victorias> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1][1] + " <br>#3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4][0] + ": " + tableau[4][1]);<br>
    }<br>
    if (statNumber % 5 == 2) {<br>
        Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.GL])]); } });<br>
        if (tableau.length < 5) {<br>
            return false;<br>
        }<br>
        tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
        room.sendChat("Goles> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1][1] + " #3 "<br> + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4][0] + ": " + tableau[4][1]);<br>
    }<br>
    if (statNumber % 5 == 3) {<br>
        Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.AS])]); } });<br>
        if (tableau.length < 5) {<br>
            return false;<br>
        }<br>
        tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
        room.sendChat("Asistencias> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1][1] + " <br>#3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4][0] + ": " + tableau[4][1]);<br>
    }<br>
    if (statNumber % 5 == 4) {<br>
        Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))<br>[Ss.CS])]); } });
        if (tableau.length < 5) {<br>
            return false;<br>
        }<br>
        tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
        room.sendChat("CS> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1][1] + " #3 " + <br>tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4][0] + ": " + <br>tableau[4][1]);
    }<br>
    statNumber++;<br>
}, statInterval * 60 * 1000);<br>
<br>
/* EVENTS */<br>
<br>
/* PLAYER MOVEMENT */<br>
<br>
room.onPlayerJoin = function (player) {<br>
	console.log("---------------------------------------------------");<br>
	console.log("[📢]Nick: "+player.name);<br>
	console.log("[📢]Conn: "+player.conn);<br>
	console.log("[📢]Auth: "+player.auth);<br>
    extendedP.push([player.id, player.auth, player.conn, false, 0, 0, false]);<br>
    updateRoleOnPlayerIn();<br>
    if (room.getPlayerList().length == playersToSetVIP){<br>
        room.setPassword(vipPassword); // Contraseña<br>
        room.sendAnnouncement("[💎] 𝗦𝗹𝗼𝘁𝘀 𝗥𝗲𝘀𝗲𝗿𝘃𝗮𝗱𝗼𝘀", null, 0xFFC375, "bold") // Frase de slots reservados<br>
    }<br>
    room.sendAnnouncement("---------------------------------------------------", player.id,0x4A3FF5);<br>
    room.sendAnnouncement("👋 ¡𝗕𝗶𝗲𝗻𝘃𝗲𝗻𝗶𝗱𝗼 " + player.name + " 𝗔 𝗙𝘂𝘁𝘀𝗮𝗹 𝗖𝗼𝗺𝗺𝘂𝗻𝗶𝘁𝘆!", null, 0xFFC37,"bold");<br>
    room.sendAnnouncement("👑 ¡𝗙𝘂𝘁𝘀𝗮𝗹 𝘅𝟳! (𝗛𝗼𝘀𝘁 𝗱𝗲 𝗽𝗿𝘂𝗲𝗯𝗮)", player.id,0xFFC375,"bold");<br>
    room.sendAnnouncement("---------------------------------------------------", player.id, 0x4A3FF5);<br>
    if (room.getPlayerList().length > 1 && room.getPlayerList().length < 5 ){<br>
            room.sendAnnouncement("😎 ¡𝗘𝗹 𝗺𝗼𝗱𝗼 𝗱𝗲 𝗽𝗿𝗮𝗰𝘁𝗶𝗰𝗮 𝗲𝘀𝘁á 𝗮𝗰𝘁𝗶𝘃𝗮𝗱𝗼 𝗵𝗮𝘀𝘁𝗮 𝗾𝘂𝗲 𝗵𝗮𝘆𝗮𝗻 𝟲 <br>𝗽𝗲𝗿𝘀𝗼𝗻𝗮𝘀 𝗲𝗻 𝗲𝗹 𝗵𝗼𝘀𝘁!", player.id, 0x4A3FF5);
    }<br>
    if (localStorage.getItem(player.auth) != null) {<br>
        var playerRole = JSON.parse(localStorage.getItem(player.auth))[Ss.RL];<br>
        if (playerRole == "admin" || playerRole == "master" ) {<br>
            room.setPlayerAdmin(player.id, true);<br>
            room.sendAnnouncement("Admin「" + player.name + "」¡𝗘𝗻𝘁𝗿𝗼 𝗮 𝗽𝗼𝗻𝗲𝗿 𝗼𝗿𝗱𝗲𝗻 𝗲𝗻 𝗹𝗮 𝘀𝗮𝗹𝗮!", null, <br>0xFF7900, "bold");
        }<br>
    }<br>
    if (localStorage.getItem(getAuth(player)) == null){<br>
        stats = [0, 0, 0, 0, "0.00", 0, 0, 0, 0, "0.00", "player", player.name]<br>
        localStorage.setItem(getAuth(player), JSON.stringify(stats));<br>
    }<br>
    <br>
}<br>
<br>
room.onPlayerTeamChange = function (changedPlayer, byPlayer) {<br>
    if (changedPlayer.id == 0) {<br>
        room.setPlayerTeam(0, Team.SPECTATORS);<br>
        return;<br>
    }<br>
    if (getAFK(changedPlayer) && changedPlayer.team != Team.SPECTATORS) {<br>
        room.setPlayerTeam(changedPlayer.id, Team.SPECTATORS);<br>
        room.sendChat(changedPlayer.name + " está AFK !");<br>
        return;<br>
    }<br>
    updateTeams();<br>
    if (room.getScores() != null) {<br>
        var scores = room.getScores();<br>
        if (changedPlayer.team != Team.SPECTATORS && scores.time <= (3 / 4) * scores.timeLimit && Math.abs(scores.blue - scores.<br>red) < 2) {
            (changedPlayer.team == Team.RED) ? allReds.push(changedPlayer) : allBlues.push(changedPlayer);<br>
        }<br>
    }<br>
    if (changedPlayer.team == Team.SPECTATORS) {<br>
        setActivity(changedPlayer, 0);<br>
    }<br>
    if (inChooseMode && resettingTeams == false && byPlayer.id == 0) {<br>
        if (Math.abs(teamR.length - teamB.length) == teamS.length) {<br>
            deactivateChooseMode();<br>
            resumeGame();<br>
            var b = teamS.length;<br>
            if (teamR.length > teamB.length) {<br>
                for (var i = 0; i < b; i++) {<br>
                    setTimeout(() => { room.setPlayerTeam(teamS[0].id, Team.BLUE); }, 200 * i);<br>
                }<br>
            }<br>
            else {<br>
                for (var i = 0; i < b; i++) {<br>
                    setTimeout(() => { room.setPlayerTeam(teamS[0].id, Team.RED); }, 200 * i);<br>
                }<br>
            }<br>
            return;<br>
        }<br>
        else if ((teamR.length == maxTeamSize && teamB.length == maxTeamSize) || (teamR.length == teamB.length && teamS.length < 2)<br>) {
            deactivateChooseMode();<br>
            resumeGame();<br>
        }<br>
        else if (teamR.length <= teamB.length && redCaptainChoice != "") { // choice remembered<br>
            redCaptainChoice == "top" ? room.setPlayerTeam(teamS[0].id, Team.RED) : redCaptainChoice == "random" ? room.<br>setPlayerTeam(teamS[getRandomInt(teamS.length)].id, Team.RED) : room.setPlayerTeam(teamS[teamS.length - 1].id, Team.<br>RED);
            return;<br>
        }<br>
        else if (teamB.length < teamR.length && blueCaptainChoice != "") {<br>
            blueCaptainChoice == "top" ? room.setPlayerTeam(teamS[0].id, Team.BLUE) : blueCaptainChoice == "random" ? room.<br>setPlayerTeam(teamS[getRandomInt(teamS.length)].id, Team.BLUE) : room.setPlayerTeam(teamS[teamS.length - 1].id, <br>Team.BLUE);
            return;<br>
        }<br>
        else {<br>
            choosePlayer();<br>
        }<br>
    }<br>
}<br>
<br>
room.onPlayerLeave = function (player) {<br>
    if (teamR.findIndex((red) => red.id == player.id) == 0 && inChooseMode && teamR.length <= teamB.length) {<br>
        choosePlayer();<br>
        capLeft = true; setTimeout(() => { capLeft = false; }, 10);<br>
    }<br>
    if (teamB.findIndex((blue) => blue.id == player.id) == 0 && inChooseMode && teamB.length < teamR.length) {<br>
        choosePlayer();<br>
        capLeft = true; setTimeout(() => { capLeft = false; }, 10);<br>
    }<br>
    setActivity(player, 0);<br>
    updateRoleOnPlayerOut();<br>
    if (room.getPlayerList().length == playersToSetPublic){<br>
        room.setPassword();<br>
        room.sendChat("[✅] Host abierto al publico.",null);<br>
    } <br>
}<br>
<br>
room.onPlayerKicked = function (kickedPlayer, reason, ban, byPlayer) {<br>
    ban == true ? banList.push([kickedPlayer.name, kickedPlayer.id]) : null;<br>
}<br>
<br>
/* PLAYER ACTIVITY */<br>
<br>
room.onPlayerChat = function (player, message) {<br>
    originalMessage = message;<br>
    message = message.split(/ +/);<br>
    player.team != Team.SPECTATORS ? setActivity(player, 0) : null;<br>
    if (["!help"].includes(message[0].toLowerCase())) {<br>
        room.sendAnnouncement("[📄] Comandos : !me, !mostrarstats, !games, !wins, !goals, !assists, !cs, !afks, !mutes, !bans.",<br> player.id,0x309D2B,"bold");
        player.admin ? room.sendAnnouncement("[📄] Admin : !mute <duration = 3> #<id>, !unmute all/#<id>, !clearbans < number = all  >, !slow <duration>, !endslow", player.id,0x309D2B,"bold") : null;<br>
    }<br>
    else if (["!afk"].includes(message[0].toLowerCase())) {<br>
        if (players.length != 1 && player.team != Team.SPECTATORS) {<br>
            if (player.team == Team.RED && streak > 0 && room.getScores() == null) {<br>
                room.setPlayerTeam(player.id, Team.SPECTATORS);<br>
            }<br>
            else {<br>
                room.sendChat("No puedes ser AFK mientras estás en un equipo !", player.id);<br>
                return false;<br>
            }<br>
        }<br>
        else if (players.length == 1 && !getAFK(player)) {<br>
            room.setPlayerTeam(player.id, Team.SPECTATORS);<br>
        }<br>
        setAFK(player, !getAFK(player));<br>
	    room.sendAnnouncement(player.name + (getAFK(player) ? " está AFK !" : " ya está listo !"),null,(getAFK(player) ? 0xFF7B08 : <br>0x8FFF8F));
	getAFK(player) ? updateRoleOnPlayerOut() : updateRoleOnPlayerIn();<br>
    localStorage.getItem(getAuth(player)) ? stats = JSON.parse(localStorage.getItem(getAuth(player))) : stats = [0, 0, 0, 0, "0.<br>00", 0, 0, 0, 0, "0.00", "player"];<br>
    setTimeout (() => { if (getAFK(player) && stats[Ss.RL] != "vip"){room.kickPlayer(player.id,"Tiempo de afk excedido",false) } },<br>30 * 60 * 1000)
    return false;<br>
}<br>
    else if (["!afks", "!afklist"].includes(message[0].toLowerCase())) {<br>
        var cstm = "[PV] Lista de AFK : ";<br>
        for (var i = 0; i < extendedP.length; i++) {<br>
            if (room.getPlayer(extendedP[i][eP.ID]) != null && getAFK(room.getPlayer(extendedP[i][eP.ID]))) {<br>
                if (140 - cstm.length < (room.getPlayer(extendedP[i][eP.ID]).name + ", ").length) {<br>
                    room.sendChat(cstm, player.id);<br>
                    cstm = "... ";<br>
                }<br>
                cstm += room.getPlayer(extendedP[i][eP.ID]).name + ", ";<br>
            }<br>
        }<br>
        if (cstm == "[PV] Lista de AFK : ") {<br>
            room.sendChat("[PV] No hay nadie en la lista de AFK !", player.id);<br>
            return false;<br>
        }<br>
        cstm = cstm.substring(0, cstm.length - 2);<br>
        cstm += ".";<br>
        room.sendChat(cstm, player.id);<br>
    }<br>
    else if (["!me"].includes(message[0].toLowerCase())) {<br>
        var stats;<br>
        localStorage.getItem(getAuth(player)) ? stats = JSON.parse(localStorage.getItem(getAuth(player))) : stats = [0, 0, 0, 0, "0.<br>00", 0, 0, 0, 0, "0.00"];
	room.sendAnnouncement("[📄] Stats de " + player.name + ": 🎮 Partidos Jugados: " + stats[Ss.GA] + ", ✅ Victorias: " + stats[Ss.<br>WI] + ", ❌ Derrotas: " + stats[Ss.LS] + ", WR: " + stats[Ss.WR] + "%, ⚽️ Goles: " + stats[Ss.GL] + ", 👟 Asistencias: " + <br>stats[Ss.AS] + ", 🤚 GK: " + stats[Ss.GK] + ", 🤚 Vallas: " + stats[Ss.CS] + ", 🤚 CS%: " + stats[Ss.CP] + "%", player.id,<br>0x73EC59,"bold");
	room.sendAnnouncement("「👓」 Este mensaje solamente lo podés ver vos, si querés mostrar tus stats usa el comando <br>'!mostrarstats'!", player.id,0xFF7900,"bold");<br>
    }<br>
    else if (["!mostrarstats"].includes(message[0].toLowerCase())) {<br>
        var stats;<br>
        localStorage.getItem(getAuth(player)) ? stats = JSON.parse(localStorage.getItem(getAuth(player))) : stats = [0, 0, 0, 0, "0.<br>00", 0, 0, 0, 0, "0.00"];
        room.sendAnnouncement("[📄] El jugador " + player.name + " mostró sus stats! [!mostrarstats]",null,0xFF7900,"bold")<br>
	room.sendAnnouncement("[📄] Stats de " + player.name + ": 🎮 Partidos Jugados: " + stats[Ss.GA] + ", ✅ Victorias: " + stats[Ss.<br>WI] + ", ❌ Derrotas: " + stats[Ss.LS] + ", WR: " + stats[Ss.WR] + "%, ⚽️ Goles: " + stats[Ss.GL] + ", 👟 Asistencias: " + <br>stats[Ss.AS] + ", 🤚 GK: " + stats[Ss.GK] + ", 🤚 Vallas: " + stats[Ss.CS] + ", 🤚 CS%: " + stats[Ss.CP] + "%", null,0x73EC59,<br>"bold");
    }<br>
    else if (["!games"].includes(message[0].toLowerCase())) {<br>
	var tableau = [];<br>
	try{<br>
	Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.GA])]); } });<br>
	}<br>
	catch{<br>
        <br>
	}<br>
	if (tableau.length < 5) {<br>
		room.sendAnnouncement("[PV] Aún no se han jugado partidos suficientes.", player.id,0xFF0000);<br>
		return false;<br>
	}<br>
	tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
	room.sendAnnouncement("[📄] 🎮 Partidos Jugados> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " +<br> tableau[1][1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + <br>tableau[4][0] + ": " + tableau[4][1], player.id,0x73EC59);
    <br>
    return false;<br>
}<br>
    else if (["!wins"].includes(message[0].toLowerCase())) {<br>
	var tableau = [];<br>
	try{<br>
	Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.WI]<br>)]); } });
	}<br>
	catch{<br>
        <br>
	}<br>
	if (tableau.length < 5) {<br>
		room.sendAnnouncement("[PV] Aún no se han jugado partidos suficientes.", player.id,0x73EC59);<br>
		return false;<br>
	}<br>
	tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
	room.sendAnnouncement("[📄] ✅ Victorias> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau<br>[1][1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4][0] + ": " + tableau[4][1], player.id,0x73EC59);<br>
    <br>
    return false;<br>
}<br>
    else if (["!goats"].includes(message[0].toLowerCase())) {<br>
	var tableau = [];<br>
	try{<br>
	Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key) && JSON.parse(localStorage.getItem(key))[Ss.WI] > 400) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.WI])]); } });<br>
	}<br>
	catch{<br>
        <br>
	}<br>
	if (tableau.length < 5) {<br>
		room.sendAnnouncement("[PV] Aún nadie ha ganado tantos partidos.", player.id,0x73EC59);<br>
		return false;<br>
	}<br>
	tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
	room.sendAnnouncement("[📄] ✅ GOATS> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1]<br>[1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4]<br>[0] + ": " + tableau[4][1], player.id,0x73EC59);
    <br>
    return false;<br>
}<br>
    else if (["!goals"].includes(message[0].toLowerCase())) {<br>
	var tableau = [];<br>
	try{<br>
	Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.GL])]); } });<br>
	}<br>
	catch{<br>
        <br>
	}<br>
	if (tableau.length < 5) {<br>
		room.sendAnnouncement("[📄] Aún no se han jugado partidos suficientes.", player.id,0x73EC59);<br>
		return false;<br>
	}<br>
	tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
	room.sendAnnouncement("[📄] ⚽️ Goles> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + tableau[1]<br>[1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + tableau[4]<br>[0] + ": " + tableau[4][1], player.id,0x73EC59);
    <br>
    return false;<br>
}<br>
    else if (["!assists"].includes(message[0].toLowerCase())) {<br>
	var tableau = [];<br>
	try{<br>
	Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.AS]<br>)]); } });
	}<br>
	catch{<br>
        <br>
	}<br>
	if (tableau.length < 5) {<br>
		room.sendAnnouncement("[PV] Aún no se han jugado partidos suficientes.", player.id);<br>
		return false;<br>
	}<br>
	tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
	room.sendAnnouncement("[📄] 👟 Asistencias> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + <br>tableau[1][1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + <br>tableau[4][0] + ": " + tableau[4][1], player.id,0x73EC59);
    <br>
    return false;<br>
}<br>
    else if (["!cs"].includes(message[0].toLowerCase())) {<br>
	var tableau = [];<br>
	try{<br>
	Object.keys(localStorage).forEach(function (key) { if (!["player_name", "view_mode", "geo", "avatar", "player_auth_key"].<br>includes(key)) { tableau.push([(JSON.parse(localStorage.getItem(key))[Ss.NK]), (JSON.parse(localStorage.getItem(key))[Ss.CS]<br>)]); } });
	}<br>
	catch{<br>
        <br>
	}<br>
	if (tableau.length < 5) {<br>
		room.sendAnnouncement("[PV] Aún no se han jugado partidos suficientes.", player.id,0x73EC59);<br>
		return false;<br>
	}<br>
	tableau.sort(function (a, b) { return b[1] - a[1]; });<br>
	room.sendAnnouncement("[📄] 🤚 Vallas Invictas> #1 " + tableau[0][0] + ": " + tableau[0][1] + " #2 " + tableau[1][0] + ": " + <br>tableau[1][1] + " #3 " + tableau[2][0] + ": " + tableau[2][1] + " #4 " + tableau[3][0] + ": " + tableau[3][1] + " #5 " + <br>tableau[4][0] + ": " + tableau[4][1], player.id,0x73EC59);
    <br>
    return false;<br>
}<br>
    else if (["!claim"].includes(message[0].toLowerCase())) {<br>
        if (message[1] == adminPassword) {<br>
            room.setPlayerAdmin(player.id, true);<br>
            var stats;<br>
            localStorage.getItem(getAuth(player)) ? stats = JSON.parse(localStorage.getItem(getAuth(player))) : stats = [0, 0, 0, <br>0, "0.00", 0, 0, 0, 0, "0.00", "player", player.name];
            if (stats[Ss.RL] != "master") {<br>
                stats[Ss.RL] = "master";<br>
                room.sendAnnouncement("[📄] "+player.name+" se ha logeado como admin del host!",null,0xF8FF00,"bold");<br>
                localStorage.setItem(getAuth(player), JSON.stringify(stats));<br>
            }<br>
        }<br>
    }<br>
    else if (["!setadmin", "!admin"].includes(message[0].toLowerCase())) {<br>
        if (localStorage.getItem(getAuth(player)) && JSON.parse(localStorage.getItem(getAuth(player)))[Ss.RL] == "master") {<br>
            if (message.length >= 2 && message[1][0] == "#") {<br>
                message[1] = message[1].substring(1, message[1].length);<br>
                if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null) {<br>
                    var stats;<br>
                    localStorage.getItem(getAuth(room.getPlayer(Number.parseInt(message[1])))) ? stats = JSON.parse(localStorage.<br>getItem(getAuth(room.getPlayer(Number.parseInt(message[1]))))) : stats = [0, 0, 0, 0, "0.00", 0, 0, 0, 0, <br>"0.00", "player", room.getPlayer(Number.parseInt(message[1])).name];
                    if (stats[Ss.RL] == "player") {<br>
                        stats[Ss.RL] = "admin";<br>
                        localStorage.setItem(getAuth(room.getPlayer(Number.parseInt(message[1]))), JSON.stringify(stats));<br>
                        room.setPlayerAdmin(room.getPlayer(Number.parseInt(message[1])).id, true);<br>
                        room.sendChat(room.getPlayer(Number.parseInt(message[1])).name + " ahora es el administrador del host !");<br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    else if (["!setplayer", "!removeadmin"].includes(message[0].toLowerCase())) {<br>
        if (localStorage.getItem(getAuth(player)) && JSON.parse(localStorage.getItem(getAuth(player)))[Ss.RL] == "master") {<br>
            if (message.length >= 2 && message[1][0] == "#") {<br>
                message[1] = message[1].substring(1, message[1].length);<br>
                if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null) {<br>
                    var stats;<br>
                    localStorage.getItem(getAuth(room.getPlayer(Number.parseInt(message[1])))) ? stats = JSON.parse(localStorage.<br>getItem(getAuth(room.getPlayer(Number.parseInt(message[1]))))) : stats = [0, 0, 0, 0, "0.00", 0, 0, 0, 0, <br>"0.00", "player", room.getPlayer(Number.parseInt(message[1])).name];
                    if (stats[Ss.RL] == "admin") {<br>
                        room.sendChat(room.getPlayer(Number.parseInt(message[1])).name + " Ya no es administrador del host !");<br>
                        stats[Ss.RL] = "player";<br>
                        localStorage.setItem(getAuth(room.getPlayer(Number.parseInt(message[1]))), JSON.stringify(stats));<br>
                        room.setPlayerAdmin(room.getPlayer(Number.parseInt(message[1])).id, false);<br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    else if (["!mutes", "!mutelist"].includes(message[0].toLowerCase())) {<br>
        var cstm = "[PV] Lista de muteados : ";<br>
        for (var i = 0; i < extendedP.length; i++) {<br>
            if (room.getPlayer(extendedP[i][eP.ID]) != null && getMute(room.getPlayer(extendedP[i][eP.ID]))) {<br>
                if (140 - cstm.length < (room.getPlayer(extendedP[i][eP.ID]).name + "[" + (extendedP[i][eP.ID]) + "], ").length) {<br>
                    room.sendChat(cstm, player.id);<br>
                    cstm = "... ";<br>
                }<br>
                cstm += room.getPlayer(extendedP[i][eP.ID]).name + "[" + (extendedP[i][eP.ID]) + "], ";<br>
            }<br>
        }<br>
        if (cstm == "[PV] Lista de Muteados : ") {<br>
            room.sendChat("[PV] No hay nadie en la lista de muteados !", player.id);<br>
            return false;<br>
        }<br>
        cstm = cstm.substring(0, cstm.length - 2);<br>
        cstm += ".";<br>
        room.sendChat(cstm, player.id);<br>
    }<br>
    else if (["!mute"].includes(message[0].toLowerCase())) {<br>
        if (player.admin) {<br>
            updateTeams();<br><br>
            var timeOut;<br>
            if (!Number.isNaN(Number.parseInt(message[1])) && message.length > 1) {<br>
                if (Number.parseInt(message[1]) > 0) {<br>
                    timeOut = Number.parseInt(message[1]) * 60 * 1000;<br>
                }<br>
                else {<br>
                    timeOut = 3 * 60 * 1000;<br>
                }<br>
                if (message[2].length > 1 && message[2][0] == "#") {<br>
                    message[2] = message[2].substring(1, message[2].length);<br>
                    if (!Number.isNaN(Number.parseInt(message[2])) && room.getPlayer(Number.parseInt(message[2])) != null) {<br>
                        if (room.getPlayer(Number.parseInt(message[2])).admin || getMute(room.getPlayer(Number.parseInt(message[2]))<br>)) {
                            return false;<br>
                        }<br>
                        setTimeout(function (player) { setMute(player, false); }, timeOut, room.getPlayer(Number.parseInt(message[2]<br>)));
                        setMute(room.getPlayer(Number.parseInt(message[2])), true);<br>
                        room.sendChat(room.getPlayer(Number.parseInt(message[2])).name + " ha sido muteado por " + (timeOut / <br>60000) + " minutos !");
                    }<br>
                }<br>
            }<br>
            else if (Number.isNaN(Number.parseInt(message[1]))) {<br>
                if (message[1].length > 1 && message[1][0] == "#") {<br>
                    message[1] = message[1].substring(1, message[1].length);<br>
                    if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null) {<br>
                        if (room.getPlayer(Number.parseInt(message[1])).admin || getMute(room.getPlayer(Number.parseInt(message[1]))<br>)) {
                            return false;<br>
                        }<br>
                        setTimeout(function (player) { setMute(player, false); }, 3 * 60 * 1000, room.getPlayer(Number.parseInt<br>(message[1])));<br>
                        setMute(room.getPlayer(Number.parseInt(message[1])), true);<br>
                        room.sendChat(room.getPlayer(Number.parseInt(message[1])).name + " Te han muteado por 3 minutos!");<br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    else if (["!unmute"].includes(message[0].toLowerCase())) {<br>
        if (player.admin && message.length >= 2) {<br>
            if (message[1] == "all") {<br>
                extendedP.forEach((ePlayer) => { ePlayer[eP.MUTE] = false; });<br>
                room.sendChat("Se ha limpiado la lista de muteados");<br>
            }
            else if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null && getMute(room.getPlayer(Number.parseInt(message[1])))) {<br>
                setMute(room.getPlayer(Number.parseInt(message[1])), false);<br>
                room.sendChat(room.getPlayer(Number.parseInt(message[1])).name + " ha sido desmuteado !");<br>
            }<br>
            else if (Number.isNaN(Number.parseInt(message[1]))) {<br>
                if (message[1].length > 1 && message[1][0] == "#") {<br>
                    message[1] = message[1].substring(1, message[1].length);<br>
                    if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null && getMute(room.getPlayer(Number.parseInt(message[1])))) { <br>
                        setMute(room.getPlayer(Number.parseInt(message[1])), false); <br>
                        room.sendChat(room.getPlayer(Number.parseInt(message[1])).name + " ha sido desmuteado!"); <br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    else if (["!slow"].includes(message[0].toLowerCase())) {<br>
        if (player.admin) {<br>
            if (message.length == 1) {<br>
                slowMode = 2;<br>
                room.sendChat("Modo lento activado (2 segundos)!");<br>
            }<br>
            else if (message.length == 2) {<br>
                if (!Number.isNaN(Number.parseInt(message[1]))) {<br>
                    if (Number.parseInt(message[1]) > 0) {<br>
                        slowMode = Number.parseInt(message[1]);<br>
                        room.sendChat(slowMode + " segundos, modo lento activado !");<br>
                        return false;<br>
                    }<br>
                }<br>
                slowMode = 2;<br>
                room.sendChat("Modo lento activado (2 segundos)!");<br>
            }<br>
        }<br>
    }<br>
    else if (["!endslow"].includes(message[0].toLowerCase())) {<br>
        if (player.admin) {<br>
            slowMode != 0 ? room.sendChat("Modo lento terminado.") : null;<br>
            slowMode = 0;<br>
        }<br>
    }<br>
    else if (["!banlist", "!bans"].includes(message[0].toLowerCase())) {<br>
        if (banList.length == 0) {<br>
            room.sendChat("[PV] No hay nadie en la lista de baneados!", player.id);<br>
            return false;<br>
        }<br>
        var cstm = "[PV] Lista de baneados : ";<br>
        for (var i = 0; i < banList.length; i++) {<br>
            if (140 - cstm.length < (banList[i][0] + "[" + (banList[i][1]) + "], ").length) {<br>
                room.sendChat(cstm, player.id);<br>
                cstm = "... ";<br>
            }<br>
            cstm += banList[i][0] + "[" + (banList[i][1]) + "], ";<br>
        }<br>
        cstm = cstm.substring(0, cstm.length - 2);<br>
        cstm += ".";<br>
        room.sendChat(cstm, player.id);<br>
    }<br>
    else if (["!clearbans"].includes(message[0].toLowerCase())) {<br>
        if (player.admin) {<br>
            if (message.length == 1) {<br>
                room.clearBans();<br>
                room.sendChat("Bans removidos!");<br>
                banList = [];<br>
            }<br>
            if (message.length == 2) {<br>
                if (!Number.isNaN(Number.parseInt(message[1]))) {<br>
                    if (Number.parseInt(message[1]) > 0) {<br>
                        ID = Number.parseInt(message[1]);<br>
                        room.clearBan(ID);<br>
                        if (banList.length != banList.filter((array) => array[1] != ID)) {<br>
                            room.sendChat(banList.filter((array) => array[1] == ID)[0][0] + " ha sido baneado del host !");<br>
                        }<br>
                        setTimeout(() => { banList = banList.filter((array) => array[1] != ID); }, 20);<br>
                    }<br>
                }<br>
            }<br>
        room.kickPlayer(player.id, "Bye !", false);<br>
    }<br>
    else if (message[0].toLowerCase().startsWith("!fut")) {<br>
        if (player.admin) {<br>
            switch (message[0]) {<br>
                case "!fut3":<br>
                    maxTeamSize = 3;<br>
                    quickRestart();<br>
                    loadMap(x3Map, scoreLimitx3, timeLimitx3);<br>
                    break;<br>
                case "!fut4":<br>
                    maxTeamSize = 4;<br>
                    quickRestart();<br>
                    loadMap(x4Map, scoreLimitx4, timeLimitx4);           <br>   
                    break;<br>
                case "!fut5":<br>
                    maxTeamSize = 5;<br>
                    quickRestart();<br>
                    loadMap(x5Map, scoreLimitx5, timeLimitx5);<br>
                    break;<br>
                case "!fut7":<br>
                    maxTeamSize = 7;<br>
                    quickRestart();<br>
                    loadMap(x7Map, scoreLimitx7, timeLimitx7);<br>
                    break;<br>
                    <br>
                default:<br>
                    break;<br>
            }<br>
        }<br>
    }<br>
    else if (["!setvip", "!vip"].includes(message[0].toLowerCase())) {<br>
        message = message.split(" ");<br>
        if (localStorage.getItem(getAuth(player)) && JSON.parse(localStorage.getItem(getAuth(player)))[Ss.RL] == "master") {<br>
            if (message.length >= 2 && message[1][0] == "#") {<br>
                message[1] = message[1].substring(1, message[1].length);<br>
                if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null) {<br>
                    var stats;<br>
                    localStorage.getItem(getAuth(room.getPlayer(Number.parseInt(message[1])))) ? stats = JSON.parse(localStorage. <br>getItem(getAuth(room.getPlayer(Number.parseInt(message[1]))))) : stats = [0, 0, 0, 0, "0.00", 0, 0, 0, 0, "0. 00", "player", room.getPlayer(Number.parseInt(message[1])).name];<br>
                    if (stats[Ss.RL] == "player") {<br>
                        stats[Ss.RL] = "vip";<br>
                        localStorage.setItem(getAuth(room.getPlayer(Number.parseInt(message[1]))), JSON.stringify(stats));<br>
                        room.sendAnnouncement("[👑]" + room.getPlayer(Number.parseInt(message[1])).name + " ahora es jugador VIP !";<br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    else if (["!novip"].includes(message[0].toLowerCase())) {<br>
        message = message.split(" ");<br>
        if (localStorage.getItem(getAuth(player)) && JSON.parse(localStorage.getItem(getAuth(player)))[Ss.RL] == "master") {<br>
            if (message.length >= 2 && message[1][0] == "#") {<br>
                message[1] = message[1].substring(1, message[1].length);<br>
                if (!Number.isNaN(Number.parseInt(message[1])) && room.getPlayer(Number.parseInt(message[1])) != null) {<br>
                    var stats;<br>
                    localStorage.getItem(getAuth(room.getPlayer(Number.parseInt(message[1])))) ? stats = JSON.parse(localStorage.<br>getItem(getAuth(room.getPlayer(Number.parseInt(message[1]))))) : stats = [0, 0, 0, 0, "0.00", 0, 0, 0, 0, <br>"0.00", "player", room.getPlayer(Number.parseInt(message[1])).name];
                    if (stats[Ss.RL] == "vip") {<br>
                        room.sendAnnouncement("[👤]" + room.getPlayer(Number.parseInt(message[1])).name + " Ya no es jugador VIP !")<br>;
                        stats[Ss.RL] = "player";<br>
                        localStorage.setItem(getAuth(room.getPlayer(Number.parseInt(message[1]))), JSON.stringify(stats));<br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    <br>
    if (message[0][0] == "!") { //if a command is received, after process, exit<br>
        return false;<br>
    }<br>
    <br>
    if (teamR.length != 0 && teamB.length != 0 && inChooseMode) { //choosing management<br>
        if (player.id == teamR[0].id || player.id == teamB[0].id) { // we care if it's one of the captains choosing<br>
            if (teamR.length <= teamB.length && player.id == teamR[0].id) { // we care if it's red turn && red cap talking<br>
                if (["top", "auto"].includes(message[0].toLowerCase())) {<br>
                    room.setPlayerTeam(teamS[0].id, Team.RED);<br>
                    redCaptainChoice = "top";<br>
                    clearTimeout(timeOutCap);<br>
                    room.sendChat(player.name + " elegiste Top !");<br>
                    return false;<br>
                }<br>
                else if (["random", "rand"].includes(message[0].toLowerCase())) {<br>
                    var r = getRandomInt(teamS.length);<br>
                    room.setPlayerTeam(teamS[r].id, Team.RED);<br>
                    redCaptainChoice = "random";<br>
                    clearTimeout(timeOutCap);<br>
                    room.sendChat(player.name + " elegiste Random !");<br>
                    return false;<br>
                }<br>
                else if (["bottom", "bot"].includes(message[0].toLowerCase())) {<br>
                    room.setPlayerTeam(teamS[teamS.length - 1].id, Team.RED);<br>
                    redCaptainChoice = "bottom";<br>
                    clearTimeout(timeOutCap);<br>
                    room.sendChat(player.name + " elegiste Bottom !");<br>
                    return false;<br>
                }<br>
                else if (!Number.isNaN(Number.parseInt(message[0]))) {<br>
                    if (Number.parseInt(message[0]) > teamS.length || Number.parseInt(message[0]) < 1) {<br>
                        room.sendChat("[PV] El número que elegiste es inválido !", player.id);<br>
                        return false;<br>
                    }<br>
                    else {<br>
                        room.setPlayerTeam(teamS[Number.parseInt(message[0]) - 1].id, Team.RED);<br>
                        room.sendChat(player.name + " eligió a " + teamS[Number.parseInt(message[0]) - 1].name + " !");<br>
                        return false;<br>
                    }<br>
                }<br>
            }<br>
            if (teamR.length > teamB.length && player.id == teamB[0].id) { // we care if it's red turn && red cap talking<br>
                if (["top", "auto"].includes(message[0].toLowerCase())) {<br>
                    room.setPlayerTeam(teamS[0].id, Team.BLUE);<br>
                    blueCaptainChoice = "top";<br>
                    clearTimeout(timeOutCap);<br>
                    room.sendChat(player.name + " seleccionó Top !");<br>
                    return false;<br>
                }<br>
                else if (["random", "rand"].includes(message[0].toLowerCase())) {<br>
                    room.setPlayerTeam(teamS[getRandomInt(teamS.length)].id, Team.BLUE);<br>
                    blueCaptainChoice = "random";<br>
                    clearTimeout(timeOutCap);<br>
                    room.sendChat(player.name + " seleccionó Random !");<br>
                    return false;<br>
                }<br>
                else if (["bottom", "bot"].includes(message[0].toLowerCase())) {<br>
                    room.setPlayerTeam(teamS[teamS.length - 1].id, Team.BLUE);<br>
                    blueCaptainChoice = "bottom";<br>
                    clearTimeout(timeOutCap);<br>
                    room.sendChat(player.name + " seleccionó Bottom !");<br>
                    return false;<br>
                }<br>
                else if (!Number.isNaN(Number.parseInt(message[0]))) {<br>
                    if (Number.parseInt(message[0]) > teamS.length || Number.parseInt(message[0]) < 1) {<br>
                        room.sendChat("[PV] El número que elegiste es inválido !", player.id);<br>
                        return false;<br>
                    }<br>
                    else {<br>
                        room.setPlayerTeam(teamS[Number.parseInt(message[0]) - 1].id, Team.BLUE);<br>
                        room.sendChat(player.name + " eligió " + teamS[Number.parseInt(message[0]) - 1].name + " !");<br>
                        return false;<br>
                    }<br>
                }<br>
            }<br>
        }<br>
    }<br>
    <br>
    if (getMute(player)) {<br>
        room.sendChat("Usted está muteado.", player.id);<br>
        return false;<br>
    }<br>
    if (slowMode > 0) {<br>
        if (!player.admin) {<br>
            if (!SMSet.has(player.id)) {<br>
                SMSet.add(player.id);<br>
                setTimeout((number) => { SMSet.delete(number); }, slowMode * 1000, player.id);<br>
            }<br>
            else {<br>
                return false;<br>
            }<br>
        }<br>
    }<br>
    console.log("auth: "+getAuth(player));<br>
    if (localStorage.getItem(getAuth(player))){<br>
        stats = JSON.parse(localStorage.getItem(getAuth(player)));<br>
        var announcement = "";<br>
        var chatColor = "";<br>
        if (stats[Ss.WI] > 399){<br>
            announcement += "🔥 「𝐆𝐎𝐀𝐓」"<br>
            chatColor = "0xFF8000"<br>
        } else if (stats[Ss.WI] > 199){<br>
            announcement += "🔸 「𝗦𝘂𝗽𝗲𝗿-𝗘𝘀𝘁𝗿𝗲𝗹𝗹𝗮」"<br>
            chatColor = "0x0040FF"<br>
        } else if (stats[Ss.WI] > 179){<br>
            announcement += "🔹 「𝗘𝘀𝘁𝗿𝗲𝗹𝗹𝗮」"<br>
            chatColor = "0xFF7900"<br>
        } else if (stats[Ss.WI] > 159){<br>
            announcement += "✓ 「𝗖𝗮𝗺𝗽𝗲𝗼𝗻」"<br>
            chatColor = "0xFFFF00"<br>
        } else if (stats[Ss.WI] > 129){<br>
            announcement += "👑 「𝗖𝗿𝗮𝗰𝗸」"<br>
            chatColor = "0xFFC375"<br>
        } else if (stats[Ss.WI] > 89){<br>
            announcement += "💲 「𝗟𝗲𝘆𝗲𝗻𝗱𝗮」"<br>
            chatColor = "0xBFFF00"<br>
        } else if (stats[Ss.WI] > 69){<br>
            announcement += "👿 「𝐄𝐱𝐩𝐞𝐫𝐭𝐨」"<br>
            chatColor = "0xEC77CE"<br>
        } else if (stats[Ss.WI] > 59){<br>
            announcement += "💪 「𝗥𝗲𝘃𝗲𝗹𝗮𝗰𝗶𝗼𝗻」"<br>
            chatColor = "0xFA58DF"<br>
        } else if (stats[Ss.WI] > 44){<br>
            announcement += "👽 「𝗩𝗲𝘁𝗲𝗿𝗮𝗻𝗼」"<br>
            chatColor = "0x73EC59"<br>
        } else if (stats[Ss.WI] > 34){<br>
            announcement += "👿 「𝗜𝗺𝗽𝗮𝗿𝗮𝗯𝗹𝗲」"<br>
            chatColor = "0xFE2E2E"<br>
        } else if (stats[Ss.WI] > 24){<br>
            announcement += "⚽ 「𝗣𝗿𝗼𝗳𝗲𝘀𝗶𝗼𝗻𝗮𝗹」"<br>
            chatColor = "0x04B404"<br>
        } else if (stats[Ss.WI] > 14){<br>
            announcement += "😎 「𝗔𝗽𝗿𝗲𝗻𝗱𝗶𝘇」"<br>
            chatColor = "0x2EFEF7"<br>
        } else if (stats[Ss.WI] > 4){<br>
            announcement += "🎖️ 「𝗣𝗿𝗶𝗻𝗰𝗶𝗽𝗶𝗮𝗻𝘁𝗲」"<br>
            chatColor = "0xDDD4DB"<br>
        } else {<br>
            announcement += "㋡ 「𝗜𝗻𝗶𝗰𝗶𝗮𝗻𝘁𝗲」"<br>
            chatColor = "0xDDD4DB"<br>
        }<br>
        console.log(announcement);<br>
        console.log(chatColor);<br>
        var playerRole = JSON.parse(localStorage.getItem(getAuth(player)))[Ss.RL];<br>
        if (playerRole == "vip"){<br>
            announcement += "「👑VIP」";<br>
            chatColor = "0x00B4FF";<br>
        }<br>
        if (playerRole == "admin" || playerRole == "master"){<br>
            announcement += "「😈」";<br>
            chatColor = "0xF8FF00";<br>
        }<br>
        console.log(announcement);<br>
        console.log(chatColor);<br>
        console.log(originalMessage)<br>
        announcement += player.name + ": " + originalMessage;<br>
        room.sendAnnouncement(announcement, null, chatColor);<br>
        return false;   <br>
    }<br>
}<br>
<br>
room.onPlayerActivity = function (player) {<br>
    setActivity(player, 0);<br>
}<br>
<br>
room.onPlayerBallKick = function (player) {<br>
    if (lastPlayersTouched[0] == null || player.id != lastPlayersTouched[0].id) {<br>
        !activePlay ? activePlay = true : null;<br>
        lastTeamTouched = player.team;<br>
        lastPlayersTouched[1] = lastPlayersTouched[0];<br>
        lastPlayersTouched[0] = player;<br>
    }<br>
}<br>
<br>
/* GAME MANAGEMENT */<br>
<br>
room.onGameStart = function (byPlayer) {<br>
    game = new Game(Date.now(), room.getScores(), []);<br>
    countAFK = true;<br>
    activePlay = false;<br>
    goldenGoal = false;<br>
    endGameVariable = false;<br>
    lastPlayersTouched = [null, null];<br>
    Rposs = 0;<br>
    Bposs = 0;<br>
    GKList = [];<br>
    allReds = [];<br>
    allBlues = [];<br>
    if (teamR.length == maxTeamSize && teamB.length == maxTeamSize) {<br>
        for (var i = 0; i < maxTeamSize; i++) {<br>
            allReds.push(teamR[i]);<br>
            allBlues.push(teamB[i]);<br>
        }<br>
    }<br>
    for (var i = 0; i < extendedP.length; i++) {<br>
        extendedP[i][eP.GK] = 0;<br>
        extendedP[i][eP.ACT] = 0;<br>
        room.getPlayer(extendedP[i][eP.ID]) == null ? extendedP.splice(i, 1) : null;<br>
    }<br>
    deactivateChooseMode();<br>
}<br>
<br>
room.onGameStop = function (byPlayer) {<br>
    if (byPlayer.id == 0 && endGameVariable) {<br>
        updateTeams();<br>
        if (inChooseMode) {<br>
            if (players.length == 2 * maxTeamSize) {<br>
                inChooseMode = false;<br>
                resetBtn();<br>
                for (var i = 0; i < maxTeamSize; i++) {<br>
                    setTimeout(() => { randomBtn(); }, 400 * i);<br>
                }<br>
                setTimeout(() => { room.startGame(); }, 2000);<br>
            }<br>
            else {<br>
                if (lastWinner == Team.RED) {<br>
                    blueToSpecBtn();<br>
                }<br>
                else if (lastWinner == Team.BLUE) {<br>
                    redToSpecBtn();<br>
                    blueToRedBtn();<br>
                }<br>
                else {<br>
                    resetBtn();<br>
                }<br>
                setTimeout(() => { topBtn(); }, 500);<br>
            }<br>
        }<br>
        else {<br>
            if (players.length == 2) {<br>
                if (lastWinner == Team.BLUE) {<br>
                    room.setPlayerTeam(teamB[0].id, Team.RED);<br>
                    room.setPlayerTeam(teamR[0].id, Team.BLUE);<br>
                }<br>
                setTimeout(() => { room.startGame(); }, 2000);<br>
            }<br>
            else if (players.length == 3 || players.length >= 2 * maxTeamSize + 1) {<br>
                if (lastWinner == Team.RED) {<br>
                    blueToSpecBtn();<br>
                }<br>
                else {<br>
                    redToSpecBtn();<br>
                    blueToRedBtn();<br>
                }<br>
                setTimeout(() => { topBtn(); }, 200);<br>
                setTimeout(() => { room.startGame(); }, 2000);<br>
            }<br>
            else if (players.length == 4) {<br>
                resetBtn();<br>
                setTimeout(() => { randomBtn(); setTimeout(() => { randomBtn(); }, 500); }, 500);<br>
                setTimeout(() => { room.startGame(); }, 2000);<br>
            }<br>
            else if (players.length == 5 || players.length >= 2 * maxTeamSize + 1) {<br>
                if (lastWinner == Team.RED) {<br>
                    blueToSpecBtn();<br>
                }<br>
                else {<br>
                    redToSpecBtn();<br>
                    blueToRedBtn();<br>
                }<br>
                setTimeout(() => { topBtn(); }, 200);<br>
                activateChooseMode();<br>
            }<br>
            else if (players.length == 6) {<br>
                resetBtn();<br>
                setTimeout(() => { randomBtn(); setTimeout(() => { randomBtn(); setTimeout(() => { randomBtn(); }, 500); }, 500); }, 500);<br>
                setTimeout(() => { room.startGame(); }, 2000);<br>
            }<br>
        }<br>
    }<br>
}<br>
<br>
room.onGamePause = function (byPlayer) {<br>
}
<br>
room.onGameUnpause = function (byPlayer) {<br>
    if (teamR.length == 4 && teamB.length == 4 && inChooseMode || (teamR.length == teamB.length && teamS.length < 2 && inChooseMode)) {<br>
        deactivateChooseMode();<br>
    }<br>
}
<br>
room.onTeamGoal = function (team) {<br>
    activePlay = false;<br>
    countAFK = false;<br>
    const scores = room.getScores();<br>
    game.scores = scores;<br>
    if (lastPlayersTouched[0] != null && lastPlayersTouched[0].team == team) {<br>
        if (lastPlayersTouched[1] != null && lastPlayersTouched[1].team == team) {<br>
            var frasegol = frasesgoles[(Math.random() * frasesgoles.length) | 0]<br>
            var fraseasis = frasesasis[(Math.random() * frasesasis.length) | 0]<br>
            room.sendAnnouncement("⚽ " + getTime(scores) + frasegol + lastPlayersTouched[0].name + fraseasis + lastPlayersTouched[1].name + ". Velocidad de tiro : " + ballSpeed.toPrecision(4).toString() + "km/h " + (team == Team.RED ? "🔴" : "🔵"),null,(team == Team.RED ? 0xFF250D : 0x3075FF),'bold'); <br>
            game.goals.push(new Goal(scores.time, team, lastPlayersTouched[0], lastPlayersTouched[1])); <br>
        }<br>
        else {<br>
            var frasegol = frasesgoles[(Math.random() * frasesgoles.length) | 0]<br>
            room.sendAnnouncement("⚽ " + getTime(scores) + frasegol + lastPlayersTouched[0].name + " ! Velocidad de tiro : " + ballSpeed.toPrecision(4).toString() + "km/h " +  (team == Team.RED ? "🔴" : "🔵"),null,(team == Team.RED ? 0xFF250D : 0x3075FF),'bold');<br>
        }<br>
    }<br>
    else {<br>
        var fraseautogol = frasesautogol[(Math.random() * frasesautogol.length) | 0]<br>
        room.sendAnnouncement("😂 " + getTime(scores) + fraseautogol + lastPlayersTouched[0].name + " ! Velocidad de tiro : " + ballSpeed.toPrecision(4).toString() + "km/h " + (team == Team.RED ? "🔴" : "🔵"),null,(team == Team.RED ? 0xFF250D : 0x3075FF),'bold');<br>
        game.goals.push(new Goal(scores.time, team, null, null));<br>
    }<br>
    if (scores.scoreLimit != 0 && (scores.red == scores.scoreLimit || scores.blue == scores.scoreLimit && scores.blue > 0 || goldenGoal == true)) {<br>
        endGame(team);<br>
        goldenGoal = false;<br>
        setTimeout(() => { room.stopGame(); }, 1000);<br>
    }<br>
}<br>
<br>
room.onPositionsReset = function () {<br>
    countAFK = true;<br>
    lastPlayersTouched = [null, null];<br>
}<br>
<br>
/* MISCELLANEOUS */<br>
<br>
room.onRoomLink = function (url) {<br>
}<br>
<br>
room.onPlayerAdminChange = function (changedPlayer, byPlayer) {<br>
    if (getMute(changedPlayer) && changedPlayer.admin) {<br>
        room.sendChat(changedPlayer.name + " ha sido desmuteado.");<br>
        setMute(changedPlayer, false);<br>
    }<br>
    if (byPlayer.id != 0 && localStorage.getItem(getAuth(byPlayer)) && JSON.parse(localStorage.getItem(getAuth(byPlayer)))[Ss.RL] == "admin") {<br>
        room.sendChat("No tienes permiso para nombrar a un jugador como Administrador !", byPlayer.id);<br>
        room.setPlayerAdmin(changedPlayer.id, false);<br>
    }<br>
}<br>
<br>
room.onStadiumChange = function (newStadiumName, byPlayer) {<br>
}<br>
<br>
room.onGameTick = function () {<br>
        PublicitaDiscord();<br>
        PublicitaDonacion();<br>
        PublicitaHelp();<br>
        PublicitaLiga();<br>
    checkTime();<br>
    getLastTouchOfTheBall();<br>
    getStats();<br>
    handleInactivity();<br>
}<br>
    </p>
</div>
</div>
</body>
</html>